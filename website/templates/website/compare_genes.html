{% extends 'global/base.html' %}
{% load static %}

{% block styles %}
    <!-- Site-specific css/js -->
    <link rel="stylesheet" type="text/css" href="{% static 'global/css/annotype_color.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'global/css/taxid_color.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'dna-feature-viewer/css/dna-feature-viewer.js.css' %}">

    <script src="{% static 'align/js/align.js' %}"></script>
    <script src="{% static 'align/js/msa.min.js' %}"></script>

    <script src="{% static 'dna-feature-viewer/js/dna-feature-viewer.js' %}"></script>
    <script src="{% static 'global/js/bokeh-2.1.1.min.js' %}"></script>
    <script src="{% static 'global/js/bokeh-tables-2.1.1.min.js' %}"></script>
    <script src="{% static 'global/js/bokeh-widgets-2.1.1.min.js' %}"></script>

    <!-- SortableJS - https://github.com/SortableJS/Sortable -->
    <script src="{% static 'website/js/Sortable.min.js' %}"></script>

    <style>

        #gene-loci {
            height: 30rem
        }

    </style>

{% endblock %}

{% block sidebar %}

    <div class="sidebar-subcontent form-check form-check-inline">
        <label class="form-check-label" for="form-control-range"><a>Set range around gene locus</a></label>
        <input type="range" class="form-control-range" id="form-control-range" min="3000" max="300000" value="10000">

        <span>update range to <b id="range-span">10000</b> bp</span>
    </div>

    <div class="sidebar-subcontent form-check form-check-inline">
        <button type="button" class="btn btn-primary" onclick="load_dfvm()">Reload Gene Locus</button>
    </div>

    <hr>


    <div class="sidebar-subcontent form-check form-check-inline">
        <label for="msa-method"><a>Alignment method</a></label>
        <select class="form-control" id="msa-method">
            <option value="clustalo">Clustal Omega</option>
            <option value="mafft">MAFFT</option>
            <option value="muscle">Muscle</option>
        </select>
    </div>

    <div class="sidebar-subcontent form-check form-check-inline">
        <label for="msa-seqence-type"><a>Alignment sequence type</a></label>
        <select class="form-control" id="msa-seqence-type">
            <option value="protein">Protein</option>
            <option value="dna">DNA</option>
        </select>
    </div>

    <div class="sidebar-subcontent form-check form-check-inline">
        <button type="button" class="btn btn-primary" onclick="load_aln()">Reload multiple sequence alignment</button>
    </div>

{% endblock %}

{% block body %}

    <section>

        <!-- Gene Locus -->
        <div class="container">

            <h3>Alignments</h3>

            <div id="alignments">
                <button type="button" class="btn btn-primary" onclick="load_aln()">Perform multiple sequence alignment</button>
            </div>

            <span id="loading"></span>

        </div>


        <!-- Gene Locus -->
        <div class="container">
            <hr class="featurette-divider">

            <h3>Gene Loci</h3>
            <div id="gene-loci-spinner" class="spinner-border text-dark" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <div id="gene-loci"></div>

        </div>


    </section>

{% endblock %}

{% block end %}
    <script>
        let draw;

        const genes = {% if key_genes %} {{key_genes|safe}} {% else %} [] {% endif %}


        $(document).ready(function () {
            load_dfvm()
        })

        let load_dfvm = function () {
            $('#gene-loci').empty()
            load_dna_feature_viewer_multi(
                genes, $('#gene-loci'),
                span = parseInt($('#range-span').text())
            )
        }

        $('#form-control-range').on('change', function (e) {
            const span = $('#form-control-range').val()
            $('#range-span').text(span)
        })

        let load_aln = function () {
            $('#alignments').empty()

            load_alignment(
                genes,
                $('#alignments'),
                $('#msa-method').val(),
                $('#msa-seqence-type').val()
            )
        }

    </script>
{% endblock %}
