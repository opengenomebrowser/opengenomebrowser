{% extends 'global/base.html' %}
{% load static %}

{% block styles %}
    <script src="{% static 'global/js/d3.v5.min.js' %}"></script>
    <script src="{% static 'dotplot/js/d3-scale-chromatic.v1.min.js' %}"></script>
    <script src="{% static 'dotplot/js/papaparse.min.js' %}"></script>
    <script src="{% static 'dotplot/js/ramda.min.js' %}"></script>

    <script src="{% static 'dotplot/js/Dot.js' %}"></script>
    <script src="{% static 'dotplot/js/InputPanel.js' %}"></script>
    <script src="{% static 'dotplot/js/MultiSegmentScale.js' %}"></script>
    <script src="{% static 'dotplot/js/ramda.min.js' %}"></script>
    <script src="{% static 'dotplot/js/SuperUI.js' %}"></script>
    <script src="{% static 'dotplot/js/VisToolTemplate.js' %}"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'global/css/annotype_color.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'global/css/taxid_color.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'global/css/taxid_color_label.css' %}" id="taxid-color-stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'global/css/tag_color.css' %}"/>

    <!-- autocomplete -->
    <link href="{% static 'global/css/jquery.tag-editor.css' %}" rel="stylesheet"/>
    <script src="{% static 'global/js/jquery.caret.min.js' %}"></script>
    <script src="{% static 'global/js/jquery.tag-editor.min.js' %}"></script>

    <!-- basic css -->
    <link rel="stylesheet" type="text/css" href="{% static 'dotplot/css/dotplot.css' %}"/>

{% endblock %}

{% block sidebar %}

    <div class="sidebar-subcontent form-check form-check-inline" id="dotplot-panel"></div>


{% endblock %}

{% block body %}
    <section>
        <div>
            <div id="plotting-area">

            </div>
        </div>

        <div class="container" id="spinner"></div>

    </section>

{% endblock %}

{% block end %}
    <script>
        "use strict"
        var layout = VTTGlobal.layout;

        var _app_area = d3.select('#plotting-area');

        var _scales = {x: null, y: null};

        /* Set up the Dot app */
        var _dot = new DotApp(_app_area, {height: layout.svg.height, width: layout.svg.width * 1.2});


        $(document).ready(function () {
            $.ajax({
                url: "/api/get-dotplot/",
                method: 'post',
                data: {'genome1': 'FAM21789-i1-1.1', 'genome2': 'FAM6135-i1-1.1', 'mincluster': 100},
                dataType: "json",
                success: function (data, textStatus, xhr) {
                    console.log('success!!', data)
                    _dot.setCoords(data.coords, data.coords_index)
                    _dot.addAnnotationData({key: "0", data: data.annotations}, function () {
                        console.log('callback')
                    })
                },
                error: function (jqXHR, textStatus, errorThrown) {

                }
            })
        })

    </script>

{% endblock %}
